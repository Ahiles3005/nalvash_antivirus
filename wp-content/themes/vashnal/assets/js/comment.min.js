jQuery(function(e){let t={mainFormWrapper:e("#comment-form-wrapper"),md5Script:comment_params.add_script,recaptchaUrl:comment_params.recaptcha_url,recaptchaKey:comment_params.recaptcha_key,secretSelector:'input[name="secret"]',secretSourceSelector:'input[name="secret_source"]',allFormElementsSelector:":input",answerButton:e(".post__comments__list__item__answer"),answerButtonIdPrefix:"#comment_answer_",answerSuccessIdPrefix:"#comment_form_success_",answerIdPrefix:"#comment_",formIdPrefix:"#comment_form_",recaptchaIdPrefix:"comment_recaptcha_",initialRecaptchaId:"",init:function(){let n=t.mainFormWrapper.data("post-id");window.addEventListener("load",function(e){t.open(!1,0,n)}),this.answerButton.on("click",function(){t.open(!0,e(this).data("comment-id"),n)})},open:function(n,a,r){e.ajax({url:comment_params.url,type:"POST",data:{action:comment_params.action,comment_id:a,post_id:r},success:function(r){!n&&t.mainFormWrapper.length?t.mainFormWrapper.html(r):(e(t.answerIdPrefix+a).append(r),e(t.answerButtonIdPrefix+a).addClass("hidden")),t.setup(a)}})},setup:function(n){let a=e(t.formIdPrefix+n),r=t.recaptchaIdPrefix+n,i=a.find(t.secretSelector),c=a.find(t.secretSourceSelector);"function"!=typeof md5?e.getScript(t.md5Script,function(){"function"==typeof md5&&i.val(md5(c.val()))}):i.val(md5(c.val())),e.getScript(t.recaptchaUrl,function(){setTimeout(function(){t.initialRecaptchaId=grecaptcha.render(document.getElementById(r),{sitekey:t.recaptchaKey})},1e3)}),a.length&&a.on("submit",function(){return t.send(a)})},send:function(n){if(t.validate(n)){let a=n.serialize();a+="&action="+comment_params.send_action,t.setSendingState(n),e.ajax({url:comment_params.url,type:"POST",data:a,success:function(){t.showResult(n)}})}return!1},showResult:function(n){t.unsetSendingState(n);let a=n.data("id"),r=e(t.answerSuccessIdPrefix+a);if(0===a)e("#"+t.recaptchaIdPrefix+a).empty(),n.addClass("hidden"),r.removeClass("hidden"),setTimeout(function(){r.fadeOut(1e3,function(){r.addClass("hidden"),r.removeAttr("style"),grecaptcha.reset(t.initialRecaptchaId),n.find('input[type="text"], textarea').val(""),n.removeClass("hidden")})},2e3);else{let i=e(t.answerButtonIdPrefix+a);n.remove(),r.removeClass("hidden"),setTimeout(function(){r.fadeOut(1e3,function(){i.removeClass("hidden"),r.remove()})},2e3)}},validate:function(t){let n=t.find('input[type="text"], textarea'),a=!1;return n.each(function(){e(this).val().length<2?(e(this).addClass("error"),a=!0):e(this).removeClass("error")}),!a},setSendingState:function(e){e.addClass("sending"),e.find(t.allFormElementsSelector).prop("disabled",!0)},unsetSendingState:function(e){e.removeClass("sending"),e.find(t.allFormElementsSelector).prop("disabled",!1)}};t.init()});